<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Publicações - DISET</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <img src="logo gdf.png" alt="Logo GDF">
    <h1>Publicações e Legislação</h1>
  </header>
  <main class="main-content">
    <div class="card">
      <!-- Filtros e botão de inclusão -->
      <div class="filter-section">
        <div class="filter-fields">
            <label for="tipo-documento">Filtrar por tipo de documento:</label>
            <select id="tipo-documento">
                <option value="todos">Todos</option>
            </select>
            <label for="assunto">Filtrar por assunto:</label>
            <select id="assunto">
                <option value="todos">Todos</option>
            </select>
        </div>
        <a href="gestao.html" class="include-button">Incluir Publicação</a>
      </div>
      
      <div id="publications-container">
        <!-- Publicações serão carregadas aqui -->
      </div>
    </div>
  </main>
  <footer>
    <div class="back-button-container">
      <a href="index.html" class="back-button">Voltar para a página inicial</a>
      <a href="gestao.html" class="back-button">Gerenciar Publicações</a>
    </div>
    <p>© 2025 - Secretaria de Estado de Educação do Distrito Federal (SEEDF) – DISET/SUGEP</p>
  </footer>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Preenche o localStorage com dados de exemplo se ele estiver vazio
      if (!localStorage.getItem('publicacoes')) {
        const examplePublications = [
          { name: 'Portaria 123', type: 'portarias', subject: 'remanejamento', fileName: 'portaria_123.pdf' },
          { name: 'Portaria 456', type: 'portarias', subject: 'modulacao', fileName: 'portaria_456.pdf' },
          { name: 'Lei 789', type: 'leis', subject: 'provimento', fileName: 'lei_789.pdf' },
          { name: 'Resolução XYZ', type: 'resolucoes', subject: 'outros', fileName: 'resolucao_xyz.pdf' },
          { name: 'Outro documento', type: 'outros', subject: 'outros', fileName: 'doc_outro.pdf' }
        ];
        localStorage.setItem('publicacoes', JSON.stringify(examplePublications));
      }
      
      const tipoDocumentoSelect = document.getElementById('tipo-documento');
      const assuntoSelect = document.getElementById('assunto');
      
      populateFilters();
      loadAndRenderPublications();
      
      tipoDocumentoSelect.addEventListener('change', () => loadAndRenderPublications());
      assuntoSelect.addEventListener('change', () => loadAndRenderPublications());
    });

    function populateFilters() {
        const publications = JSON.parse(localStorage.getItem('publicacoes')) || [];
        const tipoDocumentoSelect = document.getElementById('tipo-documento');
        const assuntoSelect = document.getElementById('assunto');

        // Limpa as opções atuais, mantendo apenas a primeira ("Todos")
        tipoDocumentoSelect.querySelectorAll('option:not([value="todos"])').forEach(option => option.remove());
        assuntoSelect.querySelectorAll('option:not([value="todos"])').forEach(option => option.remove());
        
        const uniqueTypes = [...new Set(publications.map(pub => pub.type))];
        const uniqueSubjects = [...new Set(publications.map(pub => pub.subject))];

        const typeNames = {
            'portarias': 'Portarias',
            'leis': 'Leis',
            'resolucoes': 'Resoluções',
            'outros': 'Outros Documentos'
        };

        uniqueTypes.forEach(type => {
            const option = document.createElement('option');
            option.value = type;
            option.textContent = typeNames[type] || type;
            tipoDocumentoSelect.appendChild(option);
        });

        uniqueSubjects.forEach(subject => {
            const option = document.createElement('option');
            option.value = subject;
            option.textContent = subject.charAt(0).toUpperCase() + subject.slice(1);
            assuntoSelect.appendChild(option);
        });
    }

    function loadAndRenderPublications() {
      const tipoDocumento = document.getElementById('tipo-documento').value;
      const assunto = document.getElementById('assunto').value;
      
      const container = document.getElementById('publications-container');
      container.innerHTML = '';
      const publications = JSON.parse(localStorage.getItem('publicacoes')) || [];
      
      let filteredPublications = publications;
      if (tipoDocumento !== 'todos') {
        filteredPublications = filteredPublications.filter(pub => pub.type === tipoDocumento);
      }
      if (assunto !== 'todos') {
        filteredPublications = filteredPublications.filter(pub => pub.subject === assunto);
      }

      const groupedPublications = filteredPublications.reduce((acc, pub) => {
        if (!acc[pub.type]) {
          acc[pub.type] = [];
        }
        acc[pub.type].push(pub);
        return acc;
      }, {});

      if (filteredPublications.length === 0) {
        container.innerHTML = '<p>Nenhuma publicação encontrada para os filtros selecionados.</p>';
        return;
      }
      
      const typeNames = {
          'portarias': 'Portarias',
          'leis': 'Leis',
          'resolucoes': 'Resoluções',
          'outros': 'Outros Documentos'
      };

      for (const type in groupedPublications) {
        const group = document.createElement('div');
        group.className = 'publications-group';
        
        const header = document.createElement('div');
        header.className = 'group-header';
        header.innerHTML = `
          <span>${typeNames[type] || type}</span>
          <span class="group-toggle-icon">></span>
        `;
        
        const list = document.createElement('ul');
        list.className = 'group-list';
        
        groupedPublications[type].forEach(pub => {
          const listItem = document.createElement('li');
          const link = document.createElement('a');
          link.href = '#'; // Link temporário
          link.textContent = `${pub.name} (${pub.subject}) - Arquivo: ${pub.fileName || 'Nenhum'}`;
          listItem.appendChild(link);
          list.appendChild(listItem);
        });
        
        group.appendChild(header);
        group.appendChild(list);
        container.appendChild(group);

        // Adiciona funcionalidade para expandir/colapsar
        header.addEventListener('click', () => {
          group.classList.toggle('open');
        });
      }
    }
  </script>
</body>
</html>
